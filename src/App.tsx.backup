import { createBrowserRouter, RouterProvider, Outlet, Link, useLocation } from "react-router-dom"
import "./App.css"
import { Toaster } from "sonner"

// 布局组件
function MainLayout() {
  const location = useLocation()
  
  const navItems = [
    { path: "/", label: "🏠 首页", icon: "🏠" },
    { path: "/generator", label: "⚡ 代码生成器", icon: "⚡" },
    { path: "/dashboard", label: "📊 仪表板", icon: "📊" },
    { path: "/components", label: "🧩 组件库", icon: "🧩" },
    { path: "/projects", label: "📁 项目管理", icon: "📁" },
    { path: "/documentation", label: "📚 文档", icon: "📚" }
  ]
  
  return (
    <div className="app-container">
      <Toaster position="top-right" richColors />
      
      {/* 顶部导航栏 */}
      <header className="app-header">
        <div className="header-content">
          <div className="logo">
            <span className="logo-icon">🚀</span>
            <h1>Metacoding Studio</h1>
            <span className="version">v2.0</span>
          </div>
          
          <nav className="main-nav">
            {navItems.map((item) => (
              <Link
                key={item.path}
                to={item.path}
                className={`nav-link ${
                  location.pathname === item.path ? "active" : ""
                }`}
              >
                <span className="nav-icon">{item.icon}</span>
                <span className="nav-label">{item.label}</span>
              </Link>
            ))}
          </nav>
          
          <div className="header-actions">
            <button className="header-action">🔔</button>
            <button className="header-action">🌙</button>
            <div className="user-avatar">👤</div>
          </div>
        </div>
      </header>
      
      {/* 侧边栏（可选） */}
      <div className="app-sidebar">
        <div className="sidebar-content">
          <h3>快速操作</h3>
          <button className="sidebar-action">🚀 新建项目</button>
          <button className="sidebar-action">📁 导入模板</button>
          <button className="sidebar-action">⚡ 快速生成</button>
          
          <div className="sidebar-section">
            <h4>最近项目</h4>
            <div className="recent-project">Admin Dashboard</div>
            <div className="recent-project">E-commerce Site</div>
            <div className="recent-project">API Service</div>
          </div>
        </div>
      </div>
      
      {/* 主内容区域 */}
      <main className="app-main">
        <Outlet />
      </main>
      
      {/* 底部 */}
      <footer className="app-footer">
        <div className="footer-content">
          <p>Metacoding Studio v2.0 © {new Date().getFullYear()} - AI驱动的代码生成平台</p>
          <div className="footer-links">
            <a href="#">隐私政策</a>
            <a href="#">使用条款</a>
            <a href="#">支持</a>
            <a href="#">API文档</a>
          </div>
        </div>
      </footer>
    </div>
  )
}

// 首页组件
function HomePage() {
  return (
    <div className="home-page">
      {/* Hero 区域 */}
      <section className="hero-section">
        <div className="hero-content">
          <h1 className="hero-title">
            构建下一代 Web 应用
            <span className="gradient-text"> 从未如此简单</span>
          </h1>
          <p className="hero-subtitle">
            Metacoding Studio 是 AI 驱动的代码生成平台，帮助您快速生成高质量的 React 组件和完整项目
          </p>
          <div className="hero-actions">
            <Link to="/generator" className="cta-button primary">
              <span className="button-icon">🚀</span>
              开始生成代码
            </Link>
            <Link to="/documentation" className="cta-button secondary">
              <span className="button-icon">📚</span>
              查看文档
            </Link>
          </div>
        </div>
        <div className="hero-image">
          <div className="code-preview">
            <pre>{`// 由 Metacoding Studio 生成
import * as React from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';

export function UserDashboard() {
  const { data: users } = useQuery({
    queryKey: ['users'],
    queryFn: fetchUsers
  });

  return (
    <div className="dashboard">
      <UserTable users={users} />
      <UserActions />
    </div>
  );
}`}</pre>
          </div>
        </div>
      </section>
      
      {/* 功能特性 */}
      <section className="features-section">
        <h2 className="section-title">为什么选择 Metacoding Studio？</h2>
        <div className="features-grid">
          <div className="feature-card">
            <div className="feature-icon">⚡</div>
            <h3>闪电般快速</h3>
            <p>生成完整组件只需几秒钟，大幅提升开发效率</p>
          </div>
          <div className="feature-card">
            <div className="feature-icon">🤖</div>
            <h3>AI 智能</h3>
            <p>基于 AI 的代码建议和最佳实践</p>
          </div>
          <div className="feature-card">
            <div className="feature-icon">🎨</div>
            <h3>高度可定制</h3>
            <p>完全可配置的模板和代码风格</p>
          </div>
          <div className="feature-card">
            <div className="feature-icon">🔧</div>
            <h3>生产就绪</h3>
            <p>生成的代码符合行业标准和最佳实践</p>
          </div>
        </div>
      </section>
      
      {/* 模板展示 */}
      <section className="templates-section">
        <h2 className="section-title">热门模板</h2>
        <div className="templates-grid">
          <div className="template-card">
            <div className="template-header">
              <h3>管理后台</h3>
              <span className="template-badge">热门</span>
            </div>
            <p>完整的后台管理系统，包含用户管理、数据图表、权限控制</p>
            <div className="template-tech">
              <span>React</span>
              <span>TypeScript</span>
              <span>Tailwind</span>
            </div>
            <Link to="/generator?template=admin" className="template-use-btn">
              使用模板
            </Link>
          </div>
          
          <div className="template-card">
            <div className="template-header">
              <h3>电商网站</h3>
              <span className="template-badge">推荐</span>
            </div>
            <p>现代化电商平台，包含商品展示、购物车、支付集成</p>
            <div className="template-tech">
              <span>Next.js</span>
              <span>Stripe</span>
              <span>Prisma</span>
            </div>
            <Link to="/generator?template=ecommerce" className="template-use-btn">
              使用模板
            </Link>
          </div>
          
          <div className="template-card">
            <div className="template-header">
              <h3>API 服务</h3>
              <span className="template-badge">专业</span>
            </div>
            <p>RESTful API 服务，包含认证、文档、测试</p>
            <div className="template-tech">
              <span>Node.js</span>
              <span>Express</span>
              <span>JWT</span>
            </div>
            <Link to="/generator?template=api" className="template-use-btn">
              使用模板
            </Link>
          </div>
        </div>
      </section>
    </div>
  )
}

// Generator 页面 - 核心功能页面
function GeneratorPage() {
  return (
    <div className="generator-page">
      <div className="page-header">
        <h1 className="page-title">
          <span className="page-icon">⚡</span>
          代码生成器
        </h1>
        <p className="page-subtitle">AI 驱动的智能代码生成，快速构建生产级应用</p>
      </div>
      
      {/* 成功提示 */}
      <div className="success-banner">
        <div className="success-content">
          <h2>🎉 恭喜！路由修复成功！</h2>
          <p>React Router v7 完全正常工作，您现在可以正常使用代码生成功能</p>
          <div className="success-stats">
            <div className="stat">
              <div className="stat-value">✅</div>
              <div className="stat-label">路由修复完成</div>
            </div>
            <div className="stat">
              <div className="stat-value">82</div>
              <div className="stat-label">可用组件</div>
            </div>
            <div className="stat">
              <div className="stat-value">50</div>
              <div className="stat-label">页面模板</div>
            </div>
          </div>
        </div>
      </div>
      
      <div className="generator-content">
        {/* 左侧配置面板 */}
        <div className="config-panel">
          <div className="panel-section">
            <h3 className="panel-title">项目配置</h3>
            <div className="form-group">
              <label className="form-label">项目名称</label>
              <input 
                type="text" 
                className="form-input"
                placeholder="my-awesome-project"
                defaultValue="Metacoding-Demo"
              />
            </div>
            
            <div className="form-group">
              <label className="form-label">技术栈</label>
              <div className="tech-options">
                <label className="tech-option">
                  <input type="radio" name="tech" defaultChecked />
                  <span className="tech-label">
                    <span className="tech-icon">⚛️</span>
                    React + TypeScript
                  </span>
                </label>
                <label className="tech-option">
                  <input type="radio" name="tech" />
                  <span className="tech-label">
                    <span className="tech-icon">🟢</span>
                    Vue 3 + Composition API
                  </span>
                </label>
                <label className="tech-option">
                  <input type="radio" name="tech" />
                  <span className="tech-label">
                    <span className="tech-icon"></span>
                    Next.js + Tailwind CSS
                  </span>
                </label>
                <label className="tech-option">
                  <input type="radio" name="tech" />
                  <span className="tech-label">
                    <span className="tech-icon">⚡</span>
                    Svelte + TypeScript
                  </span>
                </label>
              </div>
            </div>
            
            <div className="form-group">
              <label className="form-label">模板类型</label>
              <select className="form-select" defaultValue="component">
                <option value="component">组件模板</option>
                <option value="page">页面模板</option>
                <option value="layout">布局模板</option>
                <option value="hook">Hook 模板</option>
                <option value="service">服务模板</option>
                <option value="full">完整项目</option>
              </select>
            </div>
            
            <div className="form-group">
              <label className="form-label">额外选项</label>
              <div className="checkbox-group">
                <label className="checkbox-label">
                  <input type="checkbox" defaultChecked />
                  <span>TypeScript 支持</span>
                </label>
                <label className="checkbox-label">
                  <input type="checkbox" defaultChecked />
                  <span>单元测试</span>
                </label>
                <label className="checkbox-label">
                  <input type="checkbox" />
                  <span>Storybook 文档</span>
                </label>
                <label className="checkbox-label">
                  <input type="checkbox" />
                  <span>Docker 配置</span>
                </label>
              </div>
            </div>
          </div>
          
          <div className="panel-section">
            <h3 className="panel-title">AI 增强</h3>
            <div className="ai-features">
              <label className="ai-feature">
                <input type="checkbox" defaultChecked />
                <span>智能代码建议</span>
              </label>
              <label className="ai-feature">
                <input type="checkbox" defaultChecked />
                <span>自动错误检测</span>
              </label>
              <label className="ai-feature">
                <input type="checkbox" />
                <span>性能优化建议</span>
              </label>
              <label className="ai-feature">
                <input type="checkbox" defaultChecked />
                <span>最佳实践检查</span>
              </label>
            </div>
          </div>
          
          <button className="generate-button">
            <span className="button-icon">🚀</span>
            生成代码
          </button>
        </div>
        
        {/* 右侧预览面板 */}
        <div className="preview-panel">
          <div className="panel-header">
            <h3 className="panel-title">代码预览</h3>
            <div className="panel-actions">
              <button className="action-button">📋 复制</button>
              <button className="action-button">💾 保存</button>
              <button className="action-button">📤 导出</button>
            </div>
          </div>
          
          <div className="code-editor">
            <div className="editor-tabs">
              <button className="editor-tab active">App.tsx</button>
              <button className="editor-tab">index.css</button>
              <button className="editor-tab">README.md</button>
            </div>
            
            <div className="code-content">
              <pre>{`// GeneratedComponent.tsx
import * as React from 'react';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card, Button, Table, Modal } from '@/components';
import { userService } from '@/services';

interface User {
  id: string;
  name: string;
  email: string;
  role: string;
  status: 'active' | 'inactive';
}

interface UserTableProps {
  onEdit?: (user: User) => void;
  onDelete?: (id: string) => void;
}

const UserTable: React.FC<UserTableProps> = ({ onEdit, onDelete }) => {
  const { data: users, isLoading, error } = useQuery({
    queryKey: ['users'],
    queryFn: userService.getUsers,
  });

  const deleteMutation = useMutation({
    mutationFn: userService.deleteUser,
    onSuccess: () => {
      // 刷新数据
      queryClient.invalidateQueries({ queryKey: ['users'] });
    },
  });

  if (isLoading) return <div className="loading">加载中...</div>;
  if (error) return <div className="error">加载失败: {error.message}</div>;

  return (
    <Card className="user-table-card">
      <div className="table-header">
        <h3>用户管理</h3>
        <Button variant="primary" onClick={() => onAdd()}>
          添加用户
        </Button>
      </div>
      
      <Table>
        <thead>
          <tr>
            <th>姓名</th>
            <th>邮箱</th>
            <th>角色</th>
            <th>状态</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          {users?.map((user) => (
            <tr key={user.id}>
              <td>{user.name}</td>
              <td>{user.email}</td>
              <td>
                <span className={\`role-badge \${user.role}\`}>
                  {user.role}
                </span>
              </td>
              <td>
                <span className={\`status-badge \${user.status}\`}>
                  {user.status === 'active' ? '活跃' : '禁用'}
                </span>
              </td>
              <td className="actions">
                <Button
                  size="sm"
                  variant="outline"
                  onClick={() => onEdit?.(user)}
                >
                  编辑
                </Button>
                <Button
                  size="sm"
                  variant="danger"
                  onClick={() => onDelete?.(user.id)}
                >
                  删除
                </Button>
              </td>
            </tr>
          ))}
        </tbody>
      </Table>
    </Card>
  );
};

export default UserTable;`}</pre>
            </div>
          </div>
          
          <div className="preview-info">
            <div className="info-item">
              <span className="info-label">文件数量:</span>
              <span className="info-value">12 个文件</span>
            </div>
            <div className="info-item">
              <span className="info-label">代码行数:</span>
              <span className="info-value">452 行</span>
            </div>
            <div className="info-item">
              <span className="info-label">生成时间:</span>
              <span className="info-value">约 2.3 秒</span>
            </div>
          </div>
        </div>
      </div>
      
      {/* 快速生成区域 */}
      <div className="quick-generate">
        <h3 className="section-title">✨ 快速生成</h3>
        <div className="quick-actions">
          <button className="quick-action">
            <span className="action-icon">📋</span>
            用户管理组件
          </button>
          <button className="quick-action">
            <span className="action-icon">📊</span>
            数据表格组件
          </button>
          <button className="quick-action">
            <span className="action-icon">🎨</span>
            表单组件
          </button>
          <button className="quick-action">
            <span className="action-icon">🔔</span>
            通知组件
          </button>
          <button className="quick-action">
            <span className="action-icon">📈</span>
            图表组件
          </button>
          <button className="quick-action">
            <span className="action-icon">🔐</span>
            登录页面
          </button>
        </div>
      </div>
      
      <div className="navigation-links">
        <Link to="/" className="back-link">
          <span className="link-icon"></span>
          返回首页
        </Link>
        <Link to="/dashboard" className="next-link">
          查看项目仪表板
          <span className="link-icon"></span>
        </Link>
      </div>
    </div>
  )
}

// 其他页面（简化版）
function DashboardPage() {
  return (
    <div className="dashboard-page">
      <h1 className="page-title">📊 项目仪表板</h1>
      <p>这里是您的项目概览和统计信息</p>
    </div>
  )
}

function ComponentsPage() {
  return (
    <div className="components-page">
      <h1 className="page-title">🧩 组件库</h1>
      <p>可复用的 UI 组件集合</p>
    </div>
  )
}

function ProjectsPage() {
  return (
    <div className="projects-page">
      <h1 className="page-title">📁 项目管理</h1>
      <p>管理您的代码生成项目</p>
    </div>
  )
}

function DocumentationPage() {
  return (
    <div className="documentation-page">
      <h1 className="page-title">📚 文档</h1>
      <p>Metacoding Studio 使用文档</p>
    </div>
  )
}

function NotFoundPage() {
  return (
    <div className="not-found-page">
      <h1 className="page-title">404 - 页面未找到</h1>
      <p>您访问的页面不存在</p>
      <Link to="/" className="back-link">返回首页</Link>
    </div>
  )
}

// 创建路由配置
const router = createBrowserRouter([
  {
    path: "/",
    element: <MainLayout />,
    children: [
      {
        index: true,
        element: <HomePage />
      },
      {
        path: "generator",
        element: <GeneratorPage />
      },
      {
        path: "dashboard",
        element: <DashboardPage />
      },
      {
        path: "components",
        element: <ComponentsPage />
      },
      {
        path: "projects",
        element: <ProjectsPage />
      },
      {
        path: "documentation",
        element: <DocumentationPage />
      },
      {
        path: "*",
        element: <NotFoundPage />
      }
    ]
  }
])

// 主应用组件
function App() {
  console.log("🚀 Metacoding Studio v2.0 启动")
  return <RouterProvider router={router} />
}

export default App

